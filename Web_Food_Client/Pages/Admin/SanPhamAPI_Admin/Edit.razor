@page "/admin/san-pham/edit/{id:int}"
@layout AdminLayout
@inject HttpClient Http
@inject NavigationManager Navigation

<h1 class="text-center">Chỉnh Sửa Sản Phẩm</h1>

<div class="text-left mb-4">
    <button class="btn btn-outline-secondary btn-lg" @onclick="QuayLai">
        <i class="fa fa-arrow-left"></i> Quay lại
    </button>
</div>

@if (sanPham != null)
{
    <div class="container">
        <div class="row justify-content-center">

            <!-- Xem trước ảnh -->
            <div class="col-md-4 text-center">
                <div class="avatar-preview mb-3">
                    <img id="previewImage" src="@sanPham.HinhAnh" alt="Ảnh Sản Phẩm" class="rounded-circle" style="width: 200px; height: 200px; object-fit: cover;" />
                </div>
                <label class="font-weight-bold image-label">Ảnh Sản Phẩm</label>
            </div>

            <!-- Form chỉnh sửa -->
            <div class="col-md-8">
                <EditForm Model="sanPham" OnValidSubmit="HandleValidSubmit">
                    <DataAnnotationsValidator />
                    <ValidationSummary />

                    <div class="form-group">
                        <label for="imageInput" class="btn btn-outline-primary mt-2">Chọn ảnh</label>
                        <InputFile id="imageInput" OnChange="OnImageChange" style="display:none" />
                    </div>

                    <div class="form-group">
                        <label>Tên Sản Phẩm</label>
                        <InputText class="form-control" @bind-Value="sanPham.TenSanPham" />
                    </div>

                    <div class="form-group">
                        <label>Giá</label>
                        <InputNumber class="form-control" @bind-Value="sanPham.Gia" />
                    </div>

                    <div class="form-group">
                        <label>Số lượng</label>
                        <InputNumber class="form-control" @bind-Value="sanPham.SoLuong" />
                    </div>

                    <div class="form-group">
                        <label>Danh Mục</label>
                        <select class="form-control" @bind="sanPham.MaDanhMuc">
                            <option value="">-- Chọn danh mục --</option>
                            @foreach (var item in danhMucList)
                            {
                                <option value="@item.MaDanhMuc">@item.TenDanhMuc</option>
                            }
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Mô Tả</label>
                        <InputTextArea class="form-control" @bind-Value="sanPham.MoTa" />
                    </div>

                    <div class="form-group">
                        <label>Ngày tạo</label>
                        <InputDate class="form-control" @bind-Value="sanPham.NgayTao" disabled />
                    </div>

                    <div class="form-group">
                        <label>Ngày cập nhật</label>
                        <InputDate class="form-control" @bind-Value="sanPham.NgayCapNhat" disabled />
                    </div>

                    <div class="form-group">
                        <button type="submit" class="btn btn-success btn-lg">Lưu Thay Đổi</button>
                    </div>
                </EditForm>
            </div>
        </div>
    </div>
}
else
{
    <p>Đang tải sản phẩm...</p>
}
